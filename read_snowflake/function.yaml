kind: spark
metadata:
  name: read-snowflake
  tag: ''
  hash: 602943ec3228bba05d97cbc444d299ac168bfc32
  project: default
spec:
  command: ''
  args: []
  image: .snow-spark
  build:
    functionSourceCode: ZnJvbSBweXNwYXJrLnNxbCBpbXBvcnQgU3BhcmtTZXNzaW9uCgpkZWYgcmVhZF9zbm93Zmxha2UoY29uZmlnLCBkYiwgc2NoZW1hLCB3YXJlaG91c2UsIHF1ZXJ5LCB0YXJnZXQpOgogICAgIiIiCiAgICBSZWFkIFNub3dmbGFrZSBhbmQgd3JpdGUgcmVzdWx0cyB0byBwYXJxdWV0CiAgICA6cGFyYW0gZGI6IFNub3dmbGFrZSBkYXRhYmFzZQogICAgOnBhcmFtIHNjaGVtYTogU25vd2ZsYWtlIHNjaGVtYQogICAgOnBhcmFtIHdhcmVob3VzZTogU25vd2ZsYWtlIHdhcmVob3VzZSBpbnN0YW5jZQogICAgOnBhcmFtIHF1ZXJ5OiBTbm93Zmxha2UgcXVlcnkgc3RyaW5nCiAgICA6cGFyYW0gdGFyZ2V0OiBGdWxsIHBhdGggdG8gcGFycXVldCBvdXRwdXQgZWc6ICJ2M2lvOi8vYmlnZGF0YS9vdXRwdXQucGFycXVldCIKICAgICIiIgogICAgc3BhcmsgPSBTcGFya1Nlc3Npb24uYnVpbGRlci5hcHBOYW1lKCJyZWFkX3Nub3dmbGFrZSIpLmdldE9yQ3JlYXRlKCkKCiAgICBzZlVSTCA9IGNvbmZpZ1sic2ZVUkwiXQogICAgc2ZVc2VyID0gY29uZmlnWyJzZlVzZXIiXQogICAgc2ZQYXNzd29yZCA9IGNvbmZpZ1sic2ZQYXNzd29yZCJdCiAgICAKICAgIHNmT3B0aW9ucyA9IHsKICAgICAgInNmVVJMIiA6IHNmVVJMLAogICAgICAic2ZVc2VyIiA6IHNmVXNlciwKICAgICAgInNmUGFzc3dvcmQiIDogc2ZQYXNzd29yZCwKICAgICAgInNmRGF0YWJhc2UiIDogZGIsCiAgICAgICJzZlNjaGVtYSIgOiBzY2hlbWEsCiAgICAgICJzZldhcmVob3VzZSIgOiB3YXJlaG91c2UKICAgIH0KCiAgICBkZiA9IHNwYXJrLnJlYWQuZm9ybWF0KCJuZXQuc25vd2ZsYWtlLnNwYXJrLnNub3dmbGFrZSIpIFwKICAgICAgLm9wdGlvbnMoKipzZk9wdGlvbnMpIFwKICAgICAgLm9wdGlvbigicXVlcnkiLCAgcXVlcnkpIFwKICAgICAgLmxvYWQoKQogICAgCiAgICBkZi53cml0ZS5wYXJxdWV0KHRhcmdldCk=
    commands: []
    code_origin: https://github.com/brennanreese/functions.git#374880a8193858a9b903a92cc9fe057c52839666:read_snowflake.py
    origin_filename: read_snowflake.py
  entry_points:
    read_snowflake:
      name: read_snowflake
      doc: Read Snowflake and write results to parquet
      parameters:
      - name: config
        default: ''
      - name: db
        doc: Snowflake database
        default: ''
      - name: schema
        doc: Snowflake schema
        default: ''
      - name: warehouse
        doc: Snowflake warehouse instance
        default: ''
      - name: query
        doc: Snowflake query string
        default: ''
      - name: target
        doc: 'Full path to parquet output eg: "v3io://bigdata/output.parquet"'
        default: ''
      outputs:
      - default: ''
      lineno: 3
  description: ''
  default_handler: read_snowflake
  disable_auto_mount: false
  env:
  - name: V3IO_API
    value: ''
  - name: V3IO_USERNAME
    value: ''
  - name: V3IO_ACCESS_KEY
    value: ''
  - name: V3IO_FRAMESD
    value: ''
  - name: CURRENT_NODE_IP
    valueFrom:
      fieldRef:
        apiVersion: v1
        fieldPath: status.hostIP
  - name: IGZ_DATA_CONFIG_FILE
    value: /igz/java/conf/v3io.conf
  priority_class_name: igz-workload-medium
  driver_resources:
    requests:
      memory: 4096m
  executor_resources:
    requests:
      memory: 4096m
  deps:
    jars:
    - local:///spark/v3io-libs/v3io-hcfs_2.12.jar
    - local:///spark/v3io-libs/v3io-spark3-streaming_2.12.jar
    - local:///spark/v3io-libs/v3io-spark3-object-dataframe_2.12.jar
    - local:///igz/java/libs/scala-library-2.12.14.jar
    - local:///spark/jars/jmx_prometheus_javaagent-0.16.1.jar
    files:
    - local:///igz/java/libs/v3io-pyspark.zip
  use_default_image: false
  monitoring:
    enabled: true
    exporter_jar: /spark/jars/jmx_prometheus_javaagent-0.16.1.jar
  affinity: null
verbose: false
