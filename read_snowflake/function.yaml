kind: spark
metadata:
  name: read-snowflake
  tag: ''
  hash: 934ae372aa36a4a66d9da2b511ea8c90031ac24e
  project: feature-store
  credentials:
    access_key: 4f4a4d69-949e-4453-b53a-03924898fe8b
spec:
  command: ''
  args: []
  image: .snow-spark
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKZnJvbSBweXNwYXJrLnNxbCBpbXBvcnQgU3BhcmtTZXNzaW9uCgpkZWYgcmVhZF9zbm93Zmxha2UoY29udGV4dCwgY29uZmlnLCBkYiwgc2NoZW1hLCB3YXJlaG91c2UsIHF1ZXJ5LCB0YXJnZXQpOgogICAgIiIiCiAgICBSZWFkIFNub3dmbGFrZSBhbmQgd3JpdGUgcmVzdWx0cyB0byBwYXJxdWV0CiAgICA6cGFyYW0gZGI6IFNub3dmbGFrZSBkYXRhYmFzZQogICAgOnBhcmFtIHNjaGVtYTogU25vd2ZsYWtlIHNjaGVtYQogICAgOnBhcmFtIHdhcmVob3VzZTogU25vd2ZsYWtlIHdhcmVob3VzZSBpbnN0YW5jZQogICAgOnBhcmFtIHF1ZXJ5OiBTbm93Zmxha2UgcXVlcnkgc3RyaW5nCiAgICA6cGFyYW0gdGFyZ2V0OiBGdWxsIHBhdGggdG8gcGFycXVldCBvdXRwdXQgZWc6ICIvdjNpby9iaWdkYXRhL291dHB1dC5wYXJxdWV0IgogICAgIiIiCiAgICBzcGFyayA9IFNwYXJrU2Vzc2lvbi5idWlsZGVyLmFwcE5hbWUoInJlYWRfc25vd2ZsYWtlIikuZ2V0T3JDcmVhdGUoKQogICAgCiAgICBzZlVSTCA9IGNvbmZpZ1sic2ZVUkwiXQogICAgc2ZVc2VyID0gY29uZmlnWyJzZlVzZXIiXQogICAgc2ZQYXNzd29yZCA9IGNvbmZpZ1sic2ZQYXNzd29yZCJdCiAgICAKICAgIHNmT3B0aW9ucyA9IHsKICAgICAgInNmVVJMIiA6IHNmVVJMLAogICAgICAic2ZVc2VyIiA6IHNmVXNlciwKICAgICAgInNmUGFzc3dvcmQiIDogc2ZQYXNzd29yZCwKICAgICAgInNmRGF0YWJhc2UiIDogZGIsCiAgICAgICJzZlNjaGVtYSIgOiBzY2hlbWEsCiAgICAgICJzZldhcmVob3VzZSIgOiB3YXJlaG91c2UKICAgIH0KCiAgICBkZiA9IHNwYXJrLnJlYWQuZm9ybWF0KCJuZXQuc25vd2ZsYWtlLnNwYXJrLnNub3dmbGFrZSIpICAgICAgIC5vcHRpb25zKCoqc2ZPcHRpb25zKSAgICAgICAub3B0aW9uKCJxdWVyeSIsICBxdWVyeSkgICAgICAgLmxvYWQoKQogICAgCiAgICBwcmludCh0YXJnZXQpCiAgICBkZi53cml0ZS5wYXJxdWV0KHRhcmdldCkKCgoKZnJvbSBtbHJ1bi5mZWF0dXJlX3N0b3JlLmFwaSBpbXBvcnQgaW5nZXN0CmRlZiBpbmdlc3RfaGFuZGxlcihjb250ZXh0KToKICAgIGluZ2VzdChtbHJ1bl9jb250ZXh0PWNvbnRleHQpICMgVGhlIGhhbmRsZXIgZnVuY3Rpb24gbXVzdCBjYWxsIGluZ2VzdCB3aXRoIHRoZSBtbHJ1bl9jb250ZXh0CiAgICAKZGVmIG15X3NwYXJrX2Z1bmMoZGYsIGNvbnRleHQ9Tm9uZSk6CiAgICByZXR1cm4gZGYuZmlsdGVyKCJiaWQ+NTUiKSAjIFB5U3BhcmsgY29kZQoK
    commands: []
    code_origin: https://github.com/igz-us-sales/igz-generic-demos.git#6a79a063f2920221888fbf9eefea098e0480ee03:read_snowflake.ipynb
    origin_filename: read-snowflake.ipynb
  entry_points:
    read_snowflake:
      name: read_snowflake
      doc: Read Snowflake and write results to parquet
      parameters:
      - name: context
        default: ''
      - name: config
        default: ''
      - name: db
        doc: Snowflake database
        default: ''
      - name: schema
        doc: Snowflake schema
        default: ''
      - name: warehouse
        doc: Snowflake warehouse instance
        default: ''
      - name: query
        doc: Snowflake query string
        default: ''
      - name: target
        doc: 'Full path to parquet output eg: "/v3io/bigdata/output.parquet"'
        default: ''
      outputs:
      - default: ''
      lineno: 5
    ingest_handler:
      name: ingest_handler
      doc: ''
      parameters:
      - name: context
        default: ''
      outputs:
      - default: ''
      lineno: 37
    my_spark_func:
      name: my_spark_func
      doc: ''
      parameters:
      - name: df
        default: ''
      - name: context
        default: null
      outputs:
      - default: ''
      lineno: 40
  description: ''
  default_handler: read_snowflake
  disable_auto_mount: false
  env:
  - name: V3IO_API
    value: ''
  - name: V3IO_USERNAME
    value: ''
  - name: V3IO_ACCESS_KEY
    value: ''
  - name: V3IO_FRAMESD
    value: ''
  - name: CURRENT_NODE_IP
    valueFrom:
      fieldRef:
        apiVersion: v1
        fieldPath: status.hostIP
  - name: IGZ_DATA_CONFIG_FILE
    value: /igz/java/conf/v3io.conf
  priority_class_name: igz-workload-medium
  driver_resources:
    requests:
      memory: 4096m
  executor_resources:
    requests:
      memory: 4096m
  deps:
    jars:
    - local:///spark/v3io-libs/v3io-hcfs_2.12.jar
    - local:///spark/v3io-libs/v3io-spark3-streaming_2.12.jar
    - local:///spark/v3io-libs/v3io-spark3-object-dataframe_2.12.jar
    - local:///igz/java/libs/scala-library-2.12.14.jar
    - local:///spark/jars/jmx_prometheus_javaagent-0.16.1.jar
    files:
    - local:///igz/java/libs/v3io-pyspark.zip
  use_default_image: false
  monitoring:
    enabled: true
    exporter_jar: /spark/jars/jmx_prometheus_javaagent-0.16.1.jar
  affinity: null
verbose: false
